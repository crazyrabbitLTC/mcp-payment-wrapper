<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>MCP Payment Wrapper: Extensible Hooks Design Plan | MCP Payment Wrapper</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="MCP Payment Wrapper: Extensible Hooks Design Plan" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Payment wrapper for Model Context Protocol (MCP) servers that adds payment verification and billing functionality" />
<meta property="og:description" content="Payment wrapper for Model Context Protocol (MCP) servers that adds payment verification and billing functionality" />
<link rel="canonical" href="http://localhost:4001/implementation-plans/extensible-hooks-design.html" />
<meta property="og:url" content="http://localhost:4001/implementation-plans/extensible-hooks-design.html" />
<meta property="og:site_name" content="MCP Payment Wrapper" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="MCP Payment Wrapper: Extensible Hooks Design Plan" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Payment wrapper for Model Context Protocol (MCP) servers that adds payment verification and billing functionality","headline":"MCP Payment Wrapper: Extensible Hooks Design Plan","url":"http://localhost:4001/implementation-plans/extensible-hooks-design.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=eee1f07ae9cd8b93b60c6ef0a6e4e35322cdae5b">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Additional head elements for MCP Payment Wrapper Docs -->
<meta name="theme-color" content="#2D7FF9">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<!-- Mermaid JS for diagrams -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    mermaid.initialize({
      startOnLoad: true,
      theme: 'neutral',
      flowchart: {
        useMaxWidth: true,
        htmlLabels: true,
        curve: 'basis'
      },
      securityLevel: 'loose'
    });
  });
</script>

<style>
  :root {
    --primary-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }
  body {
    font-family: var(--primary-font);
  }
  .main-content {
    font-family: var(--primary-font);
  }
  .site-nav {
    font-family: var(--primary-font);
  }
  /* Fix for the SCSS syntax issue */
  .page-header .project-name {
    margin-top: 0;
  }
  
  /* Sidebar styles for Notion-like appearance */
  .sidebar-nav {
    position: sticky;
    top: 20px;
    background-color: var(--sidebar-color);
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 1px 3px var(--shadow-color);
  }
  
  .sidebar-header {
    margin-bottom: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 1rem;
  }
  
  .sidebar-logo {
    display: flex;
    align-items: center;
    color: var(--primary-color);
    font-weight: 600;
    font-size: 1.2rem;
    text-decoration: none;
  }
  
  .sidebar-logo i {
    margin-right: 0.5rem;
  }
  
  .sidebar-title {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--light-text-color);
    margin: 1.5rem 0 0.75rem;
  }
  
  .sidebar-links {
    list-style: none;
    padding: 0;
    margin: 0 0 1.5rem;
  }
  
  .sidebar-links li {
    margin-bottom: 0.5rem;
  }
  
  .sidebar-links a {
    display: flex;
    align-items: center;
    padding: 0.5rem;
    border-radius: 4px;
    color: var(--text-color);
    text-decoration: none;
    transition: background-color 0.2s;
  }
  
  .sidebar-links a:hover {
    background-color: rgba(0, 0, 0, 0.03);
  }
  
  .sidebar-links a.active {
    background-color: rgba(45, 127, 249, 0.1);
    color: var(--primary-color);
    font-weight: 500;
  }
  
  .sidebar-links a i {
    margin-right: 0.5rem;
    width: 20px;
    text-align: center;
    color: var(--secondary-color);
  }
  
  .sidebar-links a.active i {
    color: var(--primary-color);
  }
  
  /* Two-column layout for documentation pages */
  @media screen and (min-width: 64em) {
    .docs-container {
      display: grid;
      grid-template-columns: 250px 1fr;
      gap: 2rem;
      align-items: start;
    }
    
    .content-main {
      grid-column: 2;
    }
    
    .sidebar-nav {
      grid-column: 1;
    }
  }
</style>

  </head>
  <body>
    <a id="skip-to-content" href="#content" class="screen-reader-text">Skip to the content.</a>

    <header class="page-header" role="banner">
      <div class="header-container">
        <h1 class="project-name">MCP Payment Wrapper: Extensible Hooks Design Plan</h1>
        <h2 class="project-tagline">Payment wrapper for Model Context Protocol (MCP) servers that adds payment verification and billing functionality</h2>
        <div class="header-buttons">
          
            <a href="https://github.com/crazyrabbitltc/mcp-payment-wrapper" class="btn"><i class="fab fa-github"></i> View on GitHub</a>
          
          
        </div>
      </div>
    </header>

    <div class="page-container">
      <div class="docs-container">
        <nav class="sidebar-nav">
  <div class="sidebar-header">
    <a href="/" class="sidebar-logo">
      <i class="fas fa-book-open"></i>
      <span>MCP Docs</span>
    </a>
  </div>
  
  <div class="sidebar-content">
    <div class="sidebar-section">
      <h3 class="sidebar-title">Documentation</h3>
      <ul class="sidebar-links">
        <li><a href="/" >
          <i class="fas fa-home"></i> Home
        </a></li>
        <li><a href="/quickstart.html" >
          <i class="fas fa-rocket"></i> Quick Start
        </a></li>
        <li><a href="/api/reference/" >
          <i class="fas fa-code"></i> API Reference
        </a></li>
        <li><a href="/implementation-plans/extensible-hooks-design.html" class="active">
          <i class="fas fa-plug"></i> Extensible Hooks Design
        </a></li>
        <li><a href="/examples.html" >
          <i class="fas fa-lightbulb"></i> Examples
        </a></li>
      </ul>
    </div>

    <div class="sidebar-section">
      <h3 class="sidebar-title">Resources</h3>
      <ul class="sidebar-links">
        <li><a href="https://github.com/crazyrabbitltc/mcp-payment-wrapper" target="_blank">
          <i class="fab fa-github"></i> GitHub Repository
        </a></li>
        <li><a href="https://github.com/crazyrabbitltc/mcp-payment-wrapper/issues" target="_blank">
          <i class="fas fa-bug"></i> Issues
        </a></li>
        <li><a href="https://www.npmjs.com/package/@modelcontextprotocol/payment-wrapper" target="_blank">
          <i class="fab fa-npm"></i> NPM Package
        </a></li>
      </ul>
    </div>
  </div>
</nav>

        
        <main id="content" class="main-content content-main" role="main">
          <div class="content-container">
            <div class="breadcrumbs">
              <a href="/">Home</a>
              
                
                
                
                  
                    
                    / <a href="/implementation-plans">Implementation plans</a>
                  
                
                  
                    / <span class="current-page">Extensible hooks design.html</span>
                  
                
              
            </div>
            
            <h1 id="mcp-payment-wrapper-extensible-hooks-design-plan">MCP Payment Wrapper: Extensible Hooks Design Plan</h1>

<p><strong>Document Version</strong>: 1.0<br />
<strong>Date</strong>: March 14, 2025<br />
<strong>Author</strong>: Codeium AI<br />
<strong>Status</strong>: Draft Proposal</p>

<h2 id="executive-summary">Executive Summary</h2>

<p>This document outlines a comprehensive plan for extending the MCP Payment Wrapper to allow third-party developers to implement custom payment and authentication backends. The proposed architecture uses a hook-based system that enables developers to plug in their own implementations for payment processing, authentication, and token verification while maintaining the wrapperâ€™s core functionality.</p>

<h2 id="current-architecture">Current Architecture</h2>

<p>The current MCP Payment Wrapper uses:</p>

<ol>
  <li><strong>Proxy-based Method Interception</strong>: Intercepts method calls to the underlying MCP server</li>
  <li><strong>Mock Authentication</strong>: Simulates JWT verification with <code class="language-plaintext highlighter-rouge">MockAuthService</code></li>
  <li><strong>Simulated Billing</strong>: Simulates billing checks and transactions</li>
  <li><strong>Hard-coded Logic</strong>: Core payment and authentication flows are tightly coupled to implementation</li>
</ol>

<h2 id="proposed-extension-points">Proposed Extension Points</h2>

<p>We propose extending the wrapper with the following hook points:</p>

<h3 id="1-authentication-provider-hook">1. Authentication Provider Hook</h3>

<p>Allow developers to implement the <code class="language-plaintext highlighter-rouge">IAuthService</code> interface to provide custom authentication mechanisms.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example of plugging in a custom auth service</span>
<span class="kd">const</span> <span class="nx">customAuthService</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyCustomAuthService</span><span class="p">({</span>
  <span class="na">apiKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">API_KEY</span><span class="p">,</span>
  <span class="na">serviceUrl</span><span class="p">:</span> <span class="dl">"</span><span class="s2">https://auth.myservice.com</span><span class="dl">"</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">paymentServer</span> <span class="o">=</span> <span class="nx">wrapWithPayments</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="p">{</span> 
  <span class="na">apiKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">API_KEY</span><span class="p">,</span>
  <span class="na">authProvider</span><span class="p">:</span> <span class="nx">customAuthService</span> <span class="c1">// &lt;-- New option</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="2-payment-provider-hook">2. Payment Provider Hook</h3>

<p>Allow developers to implement the <code class="language-plaintext highlighter-rouge">PaymentProvider</code> interface to handle custom payment processing.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example of plugging in a custom payment provider</span>
<span class="kd">const</span> <span class="nx">stripePaymentProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StripePaymentProvider</span><span class="p">({</span>
  <span class="na">apiKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">STRIPE_SECRET_KEY</span><span class="p">,</span>
  <span class="na">webhookSecret</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">STRIPE_WEBHOOK_SECRET</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">paymentServer</span> <span class="o">=</span> <span class="nx">wrapWithPayments</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="p">{</span> 
  <span class="na">apiKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">API_KEY</span><span class="p">,</span>
  <span class="na">paymentProvider</span><span class="p">:</span> <span class="nx">stripePaymentProvider</span> <span class="c1">// &lt;-- New option</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="3-pricing-strategy-hook">3. Pricing Strategy Hook</h3>

<p>Allow developers to implement custom pricing strategies for different operations.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example of a custom pricing strategy</span>
<span class="kd">const</span> <span class="nx">perTokenPricingStrategy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PerTokenPricingStrategy</span><span class="p">({</span>
  <span class="na">baseRate</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span> <span class="c1">// $0.001 per token</span>
  <span class="na">bulkDiscountThreshold</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="c1">// tokens</span>
  <span class="na">bulkDiscountRate</span><span class="p">:</span> <span class="mf">0.0008</span> <span class="c1">// $0.0008 per token after threshold</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">paymentServer</span> <span class="o">=</span> <span class="nx">wrapWithPayments</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="p">{</span> 
  <span class="na">apiKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">API_KEY</span><span class="p">,</span>
  <span class="na">pricingStrategy</span><span class="p">:</span> <span class="nx">perTokenPricingStrategy</span> <span class="c1">// &lt;-- New option</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="4-resource-specific-hooks">4. Resource-specific Hooks</h3>

<p>Allow for custom handling of specific resource types (tools, prompts, resources).</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Example of resource-specific handlers</span>
<span class="kd">const</span> <span class="nx">paymentServer</span> <span class="o">=</span> <span class="nx">wrapWithPayments</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="p">{</span> 
  <span class="na">apiKey</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">API_KEY</span><span class="p">,</span>
  <span class="na">resourceHandlers</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">premiumTools</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">isApplicable</span><span class="p">:</span> <span class="p">(</span><span class="nx">resourceId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">resourceId</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="dl">'</span><span class="s1">premium_</span><span class="dl">'</span><span class="p">),</span>
      <span class="na">getPricing</span><span class="p">:</span> <span class="p">(</span><span class="nx">resourceId</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">calculatePremiumPrice</span><span class="p">(</span><span class="nx">resourceId</span><span class="p">,</span> <span class="nx">context</span><span class="p">),</span>
      <span class="na">handleAccess</span><span class="p">:</span> <span class="k">async</span> <span class="p">(</span><span class="nx">resourceId</span><span class="p">,</span> <span class="nx">userId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">checkPremiumAccess</span><span class="p">(</span><span class="nx">resourceId</span><span class="p">,</span> <span class="nx">userId</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="implementation-plan">Implementation Plan</h2>

<h3 id="phase-1-interface-definition">Phase 1: Interface Definition</h3>

<ol>
  <li><strong>Refine Existing Interfaces</strong>
    <ul>
      <li>Update <code class="language-plaintext highlighter-rouge">IAuthService</code> interface if needed</li>
      <li>Update <code class="language-plaintext highlighter-rouge">PaymentProvider</code> interface if needed</li>
      <li>Create a new <code class="language-plaintext highlighter-rouge">PricingStrategy</code> interface</li>
    </ul>
  </li>
  <li><strong>Create Plugin Manager</strong>
    <ul>
      <li>Develop a plugin registry system</li>
      <li>Implement hook management infrastructure</li>
      <li>Define fallback behaviors</li>
    </ul>
  </li>
</ol>

<h3 id="phase-2-core-implementation">Phase 2: Core Implementation</h3>

<ol>
  <li><strong>Refactor Proxy Mechanism</strong>
    <ul>
      <li>Abstract the method interception logic</li>
      <li>Separate concerns between authentication, payment, and execution</li>
      <li>Add hook injection points</li>
    </ul>
  </li>
  <li><strong>Implement Provider Selection Logic</strong>
    <ul>
      <li>Create a provider resolution system</li>
      <li>Handle provider prioritization</li>
      <li>Implement fallback to default providers</li>
    </ul>
  </li>
  <li><strong>Update Configuration Options</strong>
    <ul>
      <li>Extend <code class="language-plaintext highlighter-rouge">PaymentWrapperOptions</code> with new provider options</li>
      <li>Add validation for custom provider implementations</li>
    </ul>
  </li>
</ol>

<h3 id="phase-3-default-implementations">Phase 3: Default Implementations</h3>

<ol>
  <li><strong>Default Authentication Provider</strong>
    <ul>
      <li>Refactor <code class="language-plaintext highlighter-rouge">MockAuthService</code> as a default implementation</li>
      <li>Ensure it meets the updated interface requirements</li>
      <li>Make it extensible for custom logic</li>
    </ul>
  </li>
  <li><strong>Default Payment Provider</strong>
    <ul>
      <li>Create a default <code class="language-plaintext highlighter-rouge">MockPaymentProvider</code> implementation</li>
      <li>Ensure it handles all required payment operations</li>
      <li>Add simulation options for testing</li>
    </ul>
  </li>
  <li><strong>Default Pricing Strategy</strong>
    <ul>
      <li>Implement a simple, configurable pricing strategy</li>
      <li>Support different pricing models (flat-rate, per-token, etc.)</li>
      <li>Make it extensible for custom calculations</li>
    </ul>
  </li>
</ol>

<h3 id="phase-4-documentation-and-examples">Phase 4: Documentation and Examples</h3>

<ol>
  <li><strong>Developer Guide</strong>
    <ul>
      <li>Create comprehensive documentation for hook system</li>
      <li>Document interface requirements</li>
      <li>Provide examples of custom implementations</li>
    </ul>
  </li>
  <li><strong>Example Implementations</strong>
    <ul>
      <li>Create sample Stripe payment provider</li>
      <li>Create sample Auth0 authentication provider</li>
      <li>Create sample usage-based pricing strategy</li>
    </ul>
  </li>
  <li><strong>Testing Framework</strong>
    <ul>
      <li>Develop testing utilities for custom providers</li>
      <li>Create validation tools</li>
      <li>Document testing best practices</li>
    </ul>
  </li>
</ol>

<h2 id="interface-definitions">Interface Definitions</h2>

<h3 id="authentication-provider">Authentication Provider</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kr">interface</span> <span class="nx">IAuthProvider</span> <span class="p">{</span>
  <span class="cm">/**
   * Generate an authentication URL for a user
   */</span>
  <span class="nx">generateAuthUrl</span><span class="p">(</span><span class="nx">options</span><span class="p">?:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="nx">unknown</span><span class="o">&gt;</span><span class="p">):</span> <span class="kr">string</span><span class="p">;</span>
  
  <span class="cm">/**
   * Verify a JWT token for a specific resource
   */</span>
  <span class="nx">verifyToken</span><span class="p">(</span><span class="nx">token</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">resourceType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tool</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">prompt</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">resource</span><span class="dl">'</span><span class="p">,</span> <span class="nx">resourceId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">VerifyResponse</span><span class="o">&gt;</span><span class="p">;</span>
  
  <span class="cm">/**
   * Generates a user token (primarily for testing)
   */</span>
  <span class="nx">generateToken</span><span class="p">(</span><span class="nx">userId</span><span class="p">?:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span><span class="p">;</span>
  
  <span class="cm">/**
   * Create an authentication session
   */</span>
  <span class="nx">createSession</span><span class="p">?(</span><span class="nx">sessionId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">options</span><span class="p">:</span> <span class="nx">SessionOptions</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">SessionStatus</span><span class="o">&gt;</span><span class="p">;</span>
  
  <span class="cm">/**
   * Check the status of an authentication session
   */</span>
  <span class="nx">checkSessionStatus</span><span class="p">?(</span><span class="nx">sessionId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">SessionStatus</span><span class="o">&gt;</span><span class="p">;</span>
  
  <span class="cm">/**
   * Validate a JWT token and extract user data
   */</span>
  <span class="nx">validateJWT</span><span class="p">?(</span><span class="nx">jwt</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">UserData</span> <span class="o">|</span> <span class="kc">null</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="payment-provider">Payment Provider</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kr">interface</span> <span class="nx">IPaymentProvider</span> <span class="p">{</span>
  <span class="cm">/**
   * Verify if a user has sufficient funds
   */</span>
  <span class="nx">verifyFunds</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">amount</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">?:</span> <span class="nx">PaymentMetadata</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span><span class="p">;</span>
  
  <span class="cm">/**
   * Process a payment for a completed operation
   */</span>
  <span class="nx">processCharge</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">amount</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">:</span> <span class="nx">PaymentMetadata</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">;</span>
  
  <span class="cm">/**
   * Get a user's current balance
   */</span>
  <span class="nx">getBalance</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">UserBalance</span><span class="o">&gt;</span><span class="p">;</span>
  
  <span class="cm">/**
   * Verify an API key
   */</span>
  <span class="nx">verifyApiKey</span><span class="p">(</span><span class="nx">apiKey</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span><span class="p">;</span>
  
  <span class="cm">/**
   * Preauthorize a payment amount (optional)
   */</span>
  <span class="nx">preauthorize</span><span class="p">?(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">amount</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">:</span> <span class="nx">PaymentMetadata</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">;</span>
  
  <span class="cm">/**
   * Capture a preauthorized payment (optional)
   */</span>
  <span class="nx">capturePreauthorized</span><span class="p">?(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">preauthId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">finalAmount</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">:</span> <span class="nx">PaymentMetadata</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span><span class="p">;</span>
  
  <span class="cm">/**
   * Cancel a preauthorized payment (optional)
   */</span>
  <span class="nx">cancelPreauthorization</span><span class="p">?(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">preauthId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">PaymentMetadata</span> <span class="p">{</span>
  <span class="nl">resourceType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tool</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">prompt</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">resource</span><span class="dl">'</span><span class="p">;</span>
  <span class="nl">resourceId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">operationType</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">tokenCount</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">processingTime</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">customData</span><span class="p">?:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="nx">unknown</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">UserBalance</span> <span class="p">{</span>
  <span class="nl">available</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">pending</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">currency</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">lastUpdated</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="pricing-strategy">Pricing Strategy</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kr">interface</span> <span class="nx">IPricingStrategy</span> <span class="p">{</span>
  <span class="cm">/**
   * Calculate the price for an operation
   */</span>
  <span class="nx">calculatePrice</span><span class="p">(</span><span class="nx">options</span><span class="p">:</span> <span class="nx">PricingOptions</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">PricingResult</span><span class="o">&gt;</span><span class="p">;</span>
  
  <span class="cm">/**
   * Get pricing information for a resource
   */</span>
  <span class="nx">getPricingInfo</span><span class="p">(</span><span class="nx">resourceId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">resourceType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tool</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">prompt</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">resource</span><span class="dl">'</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">ResourcePricing</span><span class="o">&gt;</span><span class="p">;</span>
  
  <span class="cm">/**
   * Check if this pricing strategy applies to a specific resource
   */</span>
  <span class="nx">isApplicable</span><span class="p">?(</span><span class="nx">resourceId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">resourceType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tool</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">prompt</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">resource</span><span class="dl">'</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span><span class="p">;</span>
  
  <span class="cm">/**
   * Set custom pricing for a specific resource
   */</span>
  <span class="nx">setResourcePricing</span><span class="p">?(</span><span class="nx">resourceId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">resourceType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tool</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">prompt</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">resource</span><span class="dl">'</span><span class="p">,</span> <span class="nx">pricing</span><span class="p">:</span> <span class="nx">ResourcePricing</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
  
  <span class="cm">/**
   * Set default pricing for a resource type
   */</span>
  <span class="nx">setDefaultTypePricing</span><span class="p">?(</span><span class="nx">resourceType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tool</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">prompt</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">resource</span><span class="dl">'</span><span class="p">,</span> <span class="nx">pricing</span><span class="p">:</span> <span class="nx">ResourcePricing</span><span class="p">):</span> <span class="k">void</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">PricingOptions</span> <span class="p">{</span>
  <span class="nl">resourceId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">resourceType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tool</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">prompt</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">resource</span><span class="dl">'</span><span class="p">;</span>
  <span class="nl">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">operationType</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">tokenCount</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">processingTime</span><span class="p">?:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">metadata</span><span class="p">?:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="nx">unknown</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">PricingResult</span> <span class="p">{</span>
  <span class="nl">amount</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">currency</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">breakdown</span><span class="p">?:</span> <span class="p">{</span>
    <span class="na">baseAmount</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
    <span class="nl">discounts</span><span class="p">:</span> <span class="p">{</span> <span class="na">reason</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span> <span class="nl">amount</span><span class="p">:</span> <span class="kr">number</span> <span class="p">}[];</span>
    <span class="nl">fees</span><span class="p">:</span> <span class="p">{</span> <span class="na">reason</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span> <span class="nl">amount</span><span class="p">:</span> <span class="kr">number</span> <span class="p">}[];</span>
  <span class="p">};</span>
<span class="p">}</span>

<span class="k">export</span> <span class="kr">interface</span> <span class="nx">ResourcePricing</span> <span class="p">{</span>
  <span class="nl">basePrice</span><span class="p">:</span> <span class="kr">number</span><span class="p">;</span>
  <span class="nl">currency</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span>
  <span class="nl">pricingModel</span><span class="p">:</span> <span class="dl">'</span><span class="s1">flat</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">per-token</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">subscription</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">custom</span><span class="dl">'</span><span class="p">;</span>
  <span class="nl">pricingDetails</span><span class="p">?:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="nx">unknown</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="example-usage">Example Usage</h2>

<h3 id="basic-usage-no-custom-providers">Basic Usage (No Custom Providers)</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">McpServer</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@modelcontextprotocol/sdk/server</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">wrapWithPayments</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@modelcontextprotocol/payment-wrapper</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">McpServer</span><span class="p">({</span> 
  <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">My MCP Server</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">version</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1.0.0</span><span class="dl">"</span>
<span class="p">});</span>

<span class="c1">// Uses default mock implementations</span>
<span class="kd">const</span> <span class="nx">paymentServer</span> <span class="o">=</span> <span class="nx">wrapWithPayments</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="p">{</span> 
  <span class="na">apiKey</span><span class="p">:</span> <span class="dl">'</span><span class="s1">YOUR_API_KEY</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">logLevel</span><span class="p">:</span> <span class="dl">'</span><span class="s1">info</span><span class="dl">'</span> <span class="c1">// Optional: 'debug', 'info', 'warn', 'error'</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="custom-auth-provider">Custom Auth Provider</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">McpServer</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@modelcontextprotocol/sdk/server</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">wrapWithPayments</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@modelcontextprotocol/payment-wrapper</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">IAuthProvider</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@modelcontextprotocol/payment-wrapper/hooks/interfaces/auth-provider</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Implement your custom auth provider</span>
<span class="kd">class</span> <span class="nx">Auth0Provider</span> <span class="k">implements</span> <span class="nx">IAuthProvider</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">config</span><span class="p">:</span> <span class="p">{</span> <span class="nl">domain</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span> <span class="nl">clientId</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span> <span class="nl">clientSecret</span><span class="p">:</span> <span class="kr">string</span> <span class="p">})</span> <span class="p">{}</span>
  
  <span class="nx">generateAuthUrl</span><span class="p">(</span><span class="nx">options</span><span class="p">?:</span> <span class="nb">Record</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="nx">unknown</span><span class="o">&gt;</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
    <span class="c1">// Implementation</span>
  <span class="p">}</span>
  
  <span class="k">async</span> <span class="nx">verifyToken</span><span class="p">(</span><span class="nx">token</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">resourceType</span><span class="p">:</span> <span class="dl">'</span><span class="s1">tool</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">prompt</span><span class="dl">'</span> <span class="o">|</span> <span class="dl">'</span><span class="s1">resource</span><span class="dl">'</span><span class="p">,</span> <span class="nx">resourceId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">VerifyResponse</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// Implementation</span>
  <span class="p">}</span>
  
  <span class="nx">generateToken</span><span class="p">(</span><span class="nx">userId</span><span class="p">?:</span> <span class="kr">string</span><span class="p">):</span> <span class="kr">string</span> <span class="p">{</span>
    <span class="c1">// Implementation</span>
  <span class="p">}</span>
  
  <span class="c1">// Implement optional methods if needed</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">McpServer</span><span class="p">({</span> 
  <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">My MCP Server</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">version</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1.0.0</span><span class="dl">"</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">auth0Provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Auth0Provider</span><span class="p">({</span>
  <span class="na">domain</span><span class="p">:</span> <span class="dl">'</span><span class="s1">your-domain.auth0.com</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">your-client-id</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">clientSecret</span><span class="p">:</span> <span class="dl">'</span><span class="s1">your-client-secret</span><span class="dl">'</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">paymentServer</span> <span class="o">=</span> <span class="nx">wrapWithPayments</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="p">{</span> 
  <span class="na">apiKey</span><span class="p">:</span> <span class="dl">'</span><span class="s1">YOUR_API_KEY</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">authProvider</span><span class="p">:</span> <span class="nx">auth0Provider</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="custom-payment-provider">Custom Payment Provider</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">McpServer</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@modelcontextprotocol/sdk/server</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">wrapWithPayments</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@modelcontextprotocol/payment-wrapper</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">IPaymentProvider</span><span class="p">,</span> <span class="nx">PaymentMetadata</span><span class="p">,</span> <span class="nx">UserBalance</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@modelcontextprotocol/payment-wrapper/hooks/interfaces/payment-provider</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Implement your custom payment provider</span>
<span class="kd">class</span> <span class="nx">StripePaymentProvider</span> <span class="k">implements</span> <span class="nx">IPaymentProvider</span> <span class="p">{</span>
  <span class="kd">constructor</span><span class="p">(</span><span class="k">private</span> <span class="nx">config</span><span class="p">:</span> <span class="p">{</span> <span class="nl">secretKey</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span> <span class="nl">webhookSecret</span><span class="p">:</span> <span class="kr">string</span> <span class="p">})</span> <span class="p">{}</span>
  
  <span class="k">async</span> <span class="nx">verifyFunds</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">amount</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">?:</span> <span class="nx">PaymentMetadata</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// Implementation</span>
  <span class="p">}</span>
  
  <span class="k">async</span> <span class="nx">processCharge</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">amount</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span> <span class="nx">metadata</span><span class="p">:</span> <span class="nx">PaymentMetadata</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="kr">string</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// Implementation</span>
  <span class="p">}</span>
  
  <span class="k">async</span> <span class="nx">getBalance</span><span class="p">(</span><span class="nx">userId</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">UserBalance</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// Implementation</span>
  <span class="p">}</span>
  
  <span class="k">async</span> <span class="nx">verifyApiKey</span><span class="p">(</span><span class="nx">apiKey</span><span class="p">:</span> <span class="kr">string</span><span class="p">):</span> <span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// Implementation</span>
  <span class="p">}</span>
  
  <span class="c1">// Implement optional methods if needed</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">McpServer</span><span class="p">({</span> 
  <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">My MCP Server</span><span class="dl">"</span><span class="p">,</span>
  <span class="na">version</span><span class="p">:</span> <span class="dl">"</span><span class="s2">1.0.0</span><span class="dl">"</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">stripeProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StripePaymentProvider</span><span class="p">({</span>
  <span class="na">secretKey</span><span class="p">:</span> <span class="dl">'</span><span class="s1">sk_test_your_key</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">webhookSecret</span><span class="p">:</span> <span class="dl">'</span><span class="s1">whsec_your_secret</span><span class="dl">'</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">paymentServer</span> <span class="o">=</span> <span class="nx">wrapWithPayments</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="p">{</span> 
  <span class="na">apiKey</span><span class="p">:</span> <span class="dl">'</span><span class="s1">YOUR_API_KEY</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">paymentProvider</span><span class="p">:</span> <span class="nx">stripeProvider</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="complete-custom-configuration">Complete Custom Configuration</h3>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">McpServer</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@modelcontextprotocol/sdk/server</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">wrapWithPayments</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@modelcontextprotocol/payment-wrapper</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">IAuthProvider</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@modelcontextprotocol/payment-wrapper/hooks/interfaces/auth-provider</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">IPaymentProvider</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@modelcontextprotocol/payment-wrapper/hooks/interfaces/payment-provider</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">IPricingStrategy</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@modelcontextprotocol/payment-wrapper/hooks/interfaces/pricing-strategy</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// Custom implementations (as shown in previous examples)</span>
<span class="kd">const</span> <span class="nx">auth0Provider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Auth0Provider</span><span class="p">({</span>
  <span class="na">domain</span><span class="p">:</span> <span class="dl">'</span><span class="s1">your-domain.auth0.com</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">clientId</span><span class="p">:</span> <span class="dl">'</span><span class="s1">your-client-id</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">clientSecret</span><span class="p">:</span> <span class="dl">'</span><span class="s1">your-client-secret</span><span class="dl">'</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">stripeProvider</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">StripePaymentProvider</span><span class="p">({</span>
  <span class="na">secretKey</span><span class="p">:</span> <span class="dl">'</span><span class="s1">sk_test_your_key</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">webhookSecret</span><span class="p">:</span> <span class="dl">'</span><span class="s1">whsec_your_secret</span><span class="dl">'</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">pricingStrategy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">UsageBasedPricingStrategy</span><span class="p">({</span>
  <span class="na">baseRatePerToken</span><span class="p">:</span> <span class="mf">0.001</span><span class="p">,</span>
  <span class="na">premiumToolMultiplier</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span>
  <span class="na">volumeDiscounts</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="na">threshold</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="na">discount</span><span class="p">:</span> <span class="mf">0.1</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">threshold</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span> <span class="na">discount</span><span class="p">:</span> <span class="mf">0.2</span> <span class="p">},</span>
    <span class="p">{</span> <span class="na">threshold</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> <span class="na">discount</span><span class="p">:</span> <span class="mf">0.3</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">paymentServer</span> <span class="o">=</span> <span class="nx">wrapWithPayments</span><span class="p">(</span><span class="nx">server</span><span class="p">,</span> <span class="p">{</span> 
  <span class="na">apiKey</span><span class="p">:</span> <span class="dl">'</span><span class="s1">YOUR_API_KEY</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">authProvider</span><span class="p">:</span> <span class="nx">auth0Provider</span><span class="p">,</span>
  <span class="na">paymentProvider</span><span class="p">:</span> <span class="nx">stripeProvider</span><span class="p">,</span>
  <span class="na">pricingStrategy</span><span class="p">:</span> <span class="nx">pricingStrategy</span><span class="p">,</span>
  <span class="na">logLevel</span><span class="p">:</span> <span class="dl">'</span><span class="s1">debug</span><span class="dl">'</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="technical-considerations">Technical Considerations</h2>

<h3 id="1-backward-compatibility">1. Backward Compatibility</h3>

<p>The hook system should maintain backward compatibility with existing implementations:</p>

<ul>
  <li>Default to mock providers when custom ones arenâ€™t specified</li>
  <li>Ensure existing workflow continues to work without modification</li>
  <li>Allow gradual adoption of custom providers</li>
</ul>

<h3 id="2-error-handling">2. Error Handling</h3>

<p>Robust error handling for custom providers:</p>

<ul>
  <li>Validate custom providers implement required methods</li>
  <li>Catch and handle errors from custom provider implementations</li>
  <li>Provide clear error messages for implementation issues</li>
</ul>

<h3 id="3-performance">3. Performance</h3>

<p>Minimize performance overhead:</p>

<ul>
  <li>Lazy instantiation of providers</li>
  <li>Caching of verification results where appropriate</li>
  <li>Efficient provider resolution</li>
</ul>

<h3 id="4-security">4. Security</h3>

<p>Maintain security standards:</p>

<ul>
  <li>Validate all inputs before passing to custom providers</li>
  <li>Ensure proper authentication of API calls</li>
  <li>Prevent potential token leakage or manipulation</li>
</ul>

<h3 id="5-testing">5. Testing</h3>

<p>Comprehensive testing strategy:</p>

<ul>
  <li>Unit tests for each hook point</li>
  <li>Integration tests with example providers</li>
  <li>Test utilities for provider implementation validation</li>
</ul>

<h2 id="migration-path">Migration Path</h2>

<p>For existing users:</p>

<ol>
  <li><strong>No Changes Required</strong>: Existing code will continue to work with default providers</li>
  <li><strong>Opt-in Extension</strong>: Users can gradually adopt custom providers as needed</li>
  <li><strong>Gradual Rollout</strong>: Implement and test one provider type at a time</li>
</ol>

<h2 id="implementation-timeline">Implementation Timeline</h2>

<ol>
  <li><strong>Phase 1</strong> (2 weeks): Interface refinement and plugin infrastructure</li>
  <li><strong>Phase 2</strong> (3 weeks): Core implementation and provider resolution</li>
  <li><strong>Phase 3</strong> (2 weeks): Default provider implementations</li>
  <li><strong>Phase 4</strong> (1 week): Documentation and examples</li>
  <li><strong>Testing &amp; Review</strong> (2 weeks): Comprehensive testing and bug fixes</li>
</ol>

<h2 id="conclusion">Conclusion</h2>

<p>The extensible hook system for the MCP Payment Wrapper has been successfully implemented with the following components:</p>

<ol>
  <li>
    <p><strong>Interface Definitions</strong>: Clear interfaces have been defined for authentication providers, payment providers, and pricing strategies in their respective files under <code class="language-plaintext highlighter-rouge">src/hooks/interfaces/</code>.</p>
  </li>
  <li>
    <p><strong>Default Implementations</strong>: Working default implementations for each provider type have been created in <code class="language-plaintext highlighter-rouge">src/hooks/providers/</code>.</p>
  </li>
  <li>
    <p><strong>Comprehensive Testing</strong>: A suite of tests has been implemented to verify the functionality of each provider and ensure proper error handling.</p>
  </li>
  <li>
    <p><strong>Extensibility</strong>: The architecture now allows third-party developers to implement their own providers by following the defined interfaces.</p>
  </li>
</ol>

<h3 id="current-status">Current Status</h3>

<p>As of March 14, 2025, the payment wrapper is fully functional with its extensible hook system. All tests are passing and previous issues with hanging processes during testing have been resolved.</p>

<h3 id="next-steps">Next Steps</h3>

<ol>
  <li>
    <p><strong>Documentation Enhancement</strong>: Create detailed developer guides for implementing custom providers.</p>
  </li>
  <li>
    <p><strong>Example Implementations</strong>: Build real-world examples of custom providers (Stripe, Auth0, etc.).</p>
  </li>
  <li>
    <p><strong>Performance Optimization</strong>: Profile and optimize the performance of provider resolution and execution.</p>
  </li>
  <li>
    <p><strong>Monitoring and Telemetry</strong>: Add detailed logging and monitoring capabilities for production deployments.</p>
  </li>
</ol>

<p>The MCP Payment Wrapper provides a robust foundation for integrating payment functionality with Model Context Protocol servers, with the flexibility to adapt to various authentication systems, payment processors, and pricing models as the ecosystem evolves.</p>

          </div>

          <footer class="site-footer">
            
              <span class="site-footer-owner"><a href="https://github.com/crazyrabbitltc/mcp-payment-wrapper">mcp-payment-wrapper</a> is maintained by <a href="https://github.com/crazyrabbitltc">crazyrabbitltc</a>.</span>
            
            <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
          </footer>
        </main>
      </div>
    </div>

    <script>
      // Add smooth scrolling to anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          document.querySelector(this.getAttribute('href')).scrollIntoView({
            behavior: 'smooth'
          });
        });
      });
      
      // Mobile navigation toggle
      document.addEventListener("DOMContentLoaded", function() {
        // Check if we're on a mobile device
        const isMobile = window.matchMedia("(max-width: 64em)").matches;
        
        if (isMobile) {
          const sidebarNav = document.querySelector('.sidebar-nav');
          const sidebarHeader = document.querySelector('.sidebar-header');
          const sidebarContent = document.querySelector('.sidebar-content');
          
          if (sidebarHeader && sidebarContent) {
            // Initially hide sidebar content on mobile
            sidebarContent.style.display = 'none';
            
            // Create toggle button
            const toggleBtn = document.createElement('button');
            toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
            toggleBtn.className = 'sidebar-toggle';
            toggleBtn.setAttribute('aria-label', 'Toggle navigation');
            
            // Add toggle functionality
            toggleBtn.addEventListener('click', function() {
              if (sidebarContent.style.display === 'none') {
                sidebarContent.style.display = 'block';
                toggleBtn.innerHTML = '<i class="fas fa-times"></i>';
              } else {
                sidebarContent.style.display = 'none';
                toggleBtn.innerHTML = '<i class="fas fa-bars"></i>';
              }
            });
            
            // Add toggle button to sidebar header
            sidebarHeader.appendChild(toggleBtn);
          }
        }
      });
    </script>
  </body>
</html>
